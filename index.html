<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molly Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white flex flex-col items-center justify-center min-h-screen">

    <div id="login-area" class="text-center">
        <h1 class="text-4xl font-bold mb-6">Molly Bot</h1>
        <a href="/api/auth" class="bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded-lg font-bold transition">
            Clique aqui para Logar com Discord
        </a>
    </div>

    <div id="dash" class="hidden w-full max-w-md bg-slate-800 p-8 rounded-2xl shadow-xl">
        <div class="flex items-center gap-4 mb-6">
            <img id="avatar" class="w-16 h-16 rounded-full border-2 border-indigo-500">
            <h2 id="username" class="text-xl font-bold"></h2>
        </div>

        <label class="block mb-2">Selecione o Canal:</label>
        <select id="channels" class="w-full bg-slate-700 p-2 rounded mb-4"></select>

        <button onclick="testeBot()" class="w-full bg-green-600 hover:bg-green-700 py-2 rounded font-bold">
            Enviar Mensagem de Teste
        </button>
    </div>

    <script>
        // Logica para carregar dados se logado
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        if (token) {
            document.getElementById('login-area').classList.add('hidden');
            document.getElementById('dash').classList.remove('hidden');
            carregarDados(token);
        }

        async function carregarDados(tk) {
            const resp = await fetch('https://discord.com/api/users/@me', {
                headers: { Authorization: `Bearer ${tk}` }
            });
            const user = await resp.json();
            document.getElementById('username').innerText = user.username;
            document.getElementById('avatar').src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
        }

        async function testeBot() {
            const channelId = document.getElementById('channels').value;
            await fetch('http://fi4.bot-hosting.net:20956/send-message', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ channelId: "ID_DO_CANAL", content: "Molly ativa via Web!" })
            });
            alert("Comando enviado!");
        }
    </script>
</body>
</html>
